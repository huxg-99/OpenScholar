# name: Notify Feishu on New Pull Request or push

# on:
#   pull_request:
#     types: [opened]

# jobs:
#   notify-feishu:
#     runs-on: [self-hosted]
#     steps:
#       - name: Send PR info to Feishu
#         env:
#           FEISHU_PR_NOTI_URL: https://open.feishu.cn/open-apis/bot/v2/hook/f3328238-298f-4591-af1a-1d66929fb24d
#         run: |
#           curl -X POST "$FEISHU_PR_NOTI_URL" \
#             -H 'Content-Type: application/json' \
#             -d '{
#               "msg_type": "interactive",
#               "card": {
#                 "config": {
#                   "wide_screen_mode": true
#                 },
#                 "header": {
#                   "title": {
#                     "tag": "plain_text",
#                     "content": "ğŸš€ æ–°çš„ Pull Request å·²åˆ›å»º"
#                   }
#                 },
#                 "elements": [
#                   {
#                     "tag": "markdown",
#                     "content": "**ğŸ”– æ ‡é¢˜**\n${{ github.event.pull_request.title }}"
#                   },
#                   {
#                     "tag": "markdown",
#                     "content": "**ğŸ‘¤ ä½œè€…**: [${{ github.event.pull_request.user.login }}](https://github.com/${{ github.event.pull_request.user.login }})"
#                   },
#                   {
#                     "tag": "markdown",
#                     "content": "**ğŸ“„ åˆ†æ”¯**: `${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}`"
#                   },
#                   {
#                     "tag": "action",
#                     "actions": [
#                       {
#                         "tag": "button",
#                         "text": {
#                           "tag": "lark_md",
#                           "content": "ğŸ”— æŸ¥çœ‹ PR"
#                         },
#                         "url": "${{ github.event.pull_request.html_url }}",
#                         "type": "primary"
#                       }
#                     ]
#                   }
#                 ]
#               }
#             }'
name: Notify Feishu on New Pull Request or push

on:
  pull_request:
    types: [opened]  # ç›‘å¬PRåˆ›å»ºäº‹ä»¶

jobs:
  notify-feishu:
    runs-on: [self-hosted]  # ä½¿ç”¨è‡ªæ‰˜ç®¡è¿è¡Œå™¨
    steps:
      - name: Send PR info to Feishu
        env:
          FEISHU_PR_NOTI_URL: https://open.feishu.cn/open-apis/bot/v2/hook/f3328238-298f-4591-af1a-1d66929fb24d
        run: |
          # ä½¿ç”¨ PowerShell çš„ Invoke-WebRequest æ›¿ä»£ curlï¼ˆWindows å…¼å®¹å†™æ³•ï¼‰
          $body = @{
            msg_type = "interactive"
            card = @{
              config = @{
                wide_screen_mode = $true
              }
              header = @{
                title = @{
                  tag = "plain_text"
                  content = "ğŸš€ æ–°çš„ Pull Request å·²åˆ›å»º"
                }
              }
              elements = @(
                @{
                  tag = "markdown"
                  content = "**ğŸ”– æ ‡é¢˜**`n${{ github.event.pull_request.title }}"
                },
                @{
                  tag = "markdown"
                  content = "**ğŸ‘¤ ä½œè€…**: [${{ github.event.pull_request.user.login }}](https://github.com/${{ github.event.pull_request.user.login }})"
                },
                @{
                  tag = "markdown"
                  content = "**ğŸ“„ åˆ†æ”¯**: `'${{ github.event.pull_request.head.ref }}'` â†’ `'${{ github.event.pull_request.base.ref }}'`"
                },
                @{
                  tag = "action"
                  actions = @(
                    @{
                      tag = "button"
                      text = @{
                        tag = "lark_md"
                        content = "ğŸ”— æŸ¥çœ‹ PR"
                      }
                      url = "${{ github.event.pull_request.html_url }}"
                      type = "primary"
                    }
                  )
                }
              )
            }
          } | ConvertTo-Json -Depth 10

          Invoke-WebRequest -Uri $env:FEISHU_PR_NOTI_URL `
            -Method Post `
            -ContentType "application/json" `
            -Body $body